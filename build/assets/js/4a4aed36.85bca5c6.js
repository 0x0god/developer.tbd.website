"use strict";(self.webpackChunkdeveloper_tbd_website=self.webpackChunkdeveloper_tbd_website||[]).push([[3908],{9487:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>c});var a=t(87462),o=(t(67294),t(3905));const i={title:"Protocols"},s=void 0,r={unversionedId:"web5/learn/protocols",id:"web5/learn/protocols",title:"Protocols",description:"5 minute read",source:"@site/docs/web5/learn/protocols.md",sourceDirName:"web5/learn",slug:"/web5/learn/protocols",permalink:"/docs/web5/learn/protocols",draft:!1,tags:[],version:"current",frontMatter:{title:"Protocols"},sidebar:"tutorialSidebar",previous:{title:"DWN Server",permalink:"/docs/web5/learn/dwn-server"},next:{title:"Create a Decentralized Identifier",permalink:"/docs/web5/build/decentralized-identifiers/how-to-create-did"}},l={},c=[{value:"Protocol Basics",id:"protocol-basics",level:2},{value:"Defining a Protocol",id:"defining-a-protocol",level:2},{value:"Protocols in Practice",id:"protocols-in-practice",level:2}],p={toc:c},d="wrapper";function m(e){let{components:n,...t}=e;return(0,o.kt)(d,(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"5 minute read")),(0,o.kt)("p",null,"In this document, you\u2019ll:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Learn what a protocol is"),(0,o.kt)("li",{parentName:"ul"},"See what a protocol looks like"),(0,o.kt)("li",{parentName:"ul"},"Work through defining a protocol"),(0,o.kt)("li",{parentName:"ul"},"Use a protocol in your app")),(0,o.kt)("p",null,"Protocols are a document that define a data scheme and the contract by which two Decentralized Web Nodes (DWNs) agree to communicate and share data as it pertains to the scope defined by the protocol. In other words, protocols define both the data schema and the data permissions as it relates to a certain application or use case."),(0,o.kt)("p",null,"Protocols are written in a json format that is flexible enough to detail what objects are stored as part of the application, as well as who has what permissions on those objects. Although schema and permissions are traditionally decoupled in Web2 development, protocol documents serve as a robust and concise way to define how your application handles data."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If you\u2019re interested in reading the source code for protocol definitions, you can check out the following core files in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/TBD54566975/dwn-sdk-js"},"dwn-sdk-js")," library:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/TBD54566975/dwn-sdk-js/blob/main/src/interfaces/protocols/types.ts"},"type.ts")," - The file responsible for serializing your protocol document"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/TBD54566975/dwn-sdk-js/blob/main/json-schemas/protocol-rule-set.json"},"protocol-rule-set.json")," - A schema defining how protocols should be formatted"))),(0,o.kt)("h2",{id:"protocol-basics"},"Protocol Basics"),(0,o.kt)("p",null,"Every protocol document has a few basic keys:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"types")," - Defines all the data types used in your document"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"structure")," - Used as a catch-all to define a list of properties"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"actions")," - The key word used to denote the start of a permission definition")),(0,o.kt)("p",null,"These terms are combined in a human-readable way to define both the data schema and permissions of your app."),(0,o.kt)("p",null,"To apply these concepts, lets consider if we wanted to build a basic social networking application. In our social network, we want users to be able to post images with captions that can be replied to, as well as messages with replies. This application has a data design of two key objects: images and messages. Images have caption and reply properties, while messages just have a replies property."),(0,o.kt)("p",null,"Now let\u2019s imagine how we\u2019d construct the permissions for such an app. We want all users to be able to post images and messages, but we have a few constraints on the other properties:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Only the author should be able to post an image caption"),(0,o.kt)("li",{parentName:"ul"},"Only the recipient(s) of a message should be able to reply to it"),(0,o.kt)("li",{parentName:"ul"},"Only the recipient(s) of an image should be able to reply to it")),(0,o.kt)("h2",{id:"defining-a-protocol"},"Defining a Protocol"),(0,o.kt)("p",null,"We know the key words for defining protocols - ",(0,o.kt)("inlineCode",{parentName:"p"},"types"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"structure"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"actions")," - as well as our data and permissions schemas. So our protocol would look this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "protocol": "http://social-media.xyz",\n  "types": {\n    "message": {\n      "schema": "messageSchema",\n      "dataFormats": ["text/plain"]\n    },\n    "reply": {\n      "schema": "replySchema",\n      "dataFormats": ["text/plain"]\n    },\n    "image": {\n      "schema": "imageSchema",\n      "dataFormats": ["image/jpeg"]\n    },\n    "caption": {\n      "schema": "captionSchema",\n      "dataFormats": ["text/plain"]\n    }\n  },\n  "structure": {\n    "message": {\n      "$actions": [\n        {\n          "who": "anyone",\n          "can": "write"\n        }\n      ],\n      "reply": {\n        "$actions": [\n          {\n            "who": "recipient",\n            "of": "message",\n            "can": "write"\n          }\n        ]\n      }\n    },\n    "image": {\n      "$actions": [\n        {\n          "who": "anyone",\n          "can": "read"\n        },\n        {\n          "who": "anyone",\n          "can": "write"\n        }\n      ],\n      "caption": {\n        "$actions": [\n          {\n            "who": "anyone",\n            "can": "read"\n          },\n          {\n            "who": "author",\n            "of": "image",\n            "can": "write"\n          }\n        ]\n      },\n      "reply": {\n        "$actions": [\n          {\n            "who": "author",\n            "of": "image",\n            "can": "read"\n          },\n          {\n            "who": "recipient",\n            "of": "image",\n            "can": "write"\n          }\n        ]\n      }\n    }\n  }\n}\n')),(0,o.kt)("p",null,"In the ",(0,o.kt)("inlineCode",{parentName:"p"},"types")," section, we can see how the data schema of each data type is defined. While you\u2019d ideally use a resolvable schema in this property, that is not a requirement. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"types": {\n  "message": {\n    "schema": "messageSchema",\n    "dataFormats": ["text/plain"]\n  },\n  "reply": {\n    "schema": "replySchema",\n    "dataFormats": ["text/plain"]\n  },\n  "image": {\n    "schema": "imageSchema",\n    "dataFormats": ["image/jpeg"]\n  },\n  "caption": {\n    "schema": "captionSchema",\n    "dataFormats": ["text/plain"]\n  }\n}\n')),(0,o.kt)("p",null,"You\u2019ll then notice how each of those ",(0,o.kt)("inlineCode",{parentName:"p"},"types")," is used in the large ",(0,o.kt)("inlineCode",{parentName:"p"},"structure")," object, which at a top level houses the ",(0,o.kt)("inlineCode",{parentName:"p"},"message")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"image")," data types which are critical to our social network."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"structure": {\n  "message": {\n    "$actions": [\n      {\n        "who": "anyone",\n        "can": "write"\n      }\n    ],\n    "reply": {\n      "$actions": [\n        {\n          "who": "recipient",\n          "of": "message",\n          "can": "write"\n        }\n      ]\n    }\n  },\n  "image": {\n    "$actions": [\n      {\n        "who": "anyone",\n        "can": "read"\n      },\n      {\n        "who": "anyone",\n        "can": "write"\n      }\n    ],\n    "caption": {\n      "$actions": [\n        {\n          "who": "anyone",\n          "can": "read"\n        },\n        {\n          "who": "author",\n          "of": "image",\n          "can": "write"\n        }\n      ]\n    },\n    "reply": {\n      "$actions": [\n        {\n          "who": "author",\n          "of": "image",\n          "can": "read"\n        },\n        {\n          "who": "recipient",\n          "of": "image",\n          "can": "write"\n        }\n      ]\n    }\n  }\n} \n')),(0,o.kt)("p",null,"Within ",(0,o.kt)("inlineCode",{parentName:"p"},"message"),", you\u2019ll notice we define ",(0,o.kt)("inlineCode",{parentName:"p"},"actions")," permissions to let anyone write a message to anyone..."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"message": {\n    "$actions": [\n      {\n        "who": "anyone",\n        "can": "write"\n      }\n    ],\n  ...\n},\n')),(0,o.kt)("p",null,"But then we nest another ",(0,o.kt)("inlineCode",{parentName:"p"},"structure")," object to hold the child property of ",(0,o.kt)("inlineCode",{parentName:"p"},"reply")," and define permissions on ",(0,o.kt)("inlineCode",{parentName:"p"},"reply"),". "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"message": {\n    "$actions": [\n      {\n        "who": "anyone",\n        "can": "write"\n      }\n    ],\n    "reply": {\n      "$actions": [\n        {\n          "who": "recipient",\n          "of": "message",\n          "can": "write"\n        }\n      ]\n    }\n  },\n')),(0,o.kt)("p",null,"Additionally, you\u2019ll notice the ",(0,o.kt)("inlineCode",{parentName:"p"},"image")," object below it also defines ",(0,o.kt)("inlineCode",{parentName:"p"},"actions")," permissions, along with more child properties and their permissions."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"image": {\n  "$actions": [\n    {\n      "who": "anyone",\n      "can": "read"\n    },\n    {\n      "who": "anyone",\n      "can": "write"\n    }\n  ],\n  "caption": {\n    "$actions": [\n      {\n        "who": "anyone",\n        "can": "read"\n      },\n      {\n        "who": "author",\n        "of": "image",\n        "can": "write"\n      }\n    ]\n  },\n  "reply": {\n    "$actions": [\n      {\n        "who": "author",\n        "of": "image",\n        "can": "read"\n      },\n      {\n        "who": "recipient",\n        "of": "image",\n        "can": "write"\n      }\n    ]\n  }\n}\n')),(0,o.kt)("h2",{id:"protocols-in-practice"},"Protocols in Practice"),(0,o.kt)("p",null,"To use a protocol in your app, you\u2019ll need to install that protocol to your app. You can do so using the following snippet that leverages our ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/TBD54566975/web5-js"},"web5.js")," library, where ",(0,o.kt)("inlineCode",{parentName:"p"},"myDid")," is your DID object and ",(0,o.kt)("inlineCode",{parentName:"p"},"protocolObject")," is the protocol json defined in the previous section:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const response = await web5.dwn.protocols.configure(myDid.id, protocolObject);\n")),(0,o.kt)("p",null,"Once you\u2019ve installed that protocol to your app, you\u2019re ready to communicate using the schema and permissions it defines. "),(0,o.kt)("p",null,"Building on our social media example, let\u2019s say that you wanted to post a message to your friend Alice. First, you can check if she also has the ",(0,o.kt)("inlineCode",{parentName:"p"},"social-media")," protocol installed by running:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const { record } = await web5.dwn.protocols.query({\n  from: 'did:example:alice',\n  message: {\n    filter: {\n      protocol: 'social-media',\n    },\n  },\n});\n")),(0,o.kt)("p",null,"Once you\u2019ve used this call to confirm that she does have the protocol installed, you can write to her DWN via the ",(0,o.kt)("inlineCode",{parentName:"p"},"social-media")," protocol using:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const { record } = await web5.dwn.records.create({\n  data: 'Hello, world!',\n  message: {\n    recipient: 'did:example:alice'\n    schema: 'message',\n    dataFormat: 'text/plain',\n    protocol: 'social-media',\n  },\n});\n\nawait record.send('did:example:alice')\n")),(0,o.kt)("p",null,"And that\u2019s it! You\u2019ve now written a message to Alice\u2019s DWN, which she\u2019ll be able to respond to, and you can both communicate using the ",(0,o.kt)("inlineCode",{parentName:"p"},"social-media")," protocol. "),(0,o.kt)("p",null,"This protocol enables a basic social network using Web5, which means we\u2019ve created a basic trustless, decentralized social network where your users host all of their own data; images, captions, and messages are all theirs."))}m.isMDXComponent=!0}}]);